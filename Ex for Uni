#include <iostream>
#include <cmath>
#include <algorithm>
#include <sstream>
#include <ctype.h>
#include <fstream>
#include <cstring>
#include <string>
#include <vector>
#include <windows.h>
#include <unordered_map>
#pragma warning(disable : 4996)

using namespace std;
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void calc()                                                                 //Задание 1 
{
    char sy;
    double f, s;
    cout << "1 число, 2 число, действие(+,-,*,/): ";
    cin >> f >> s >> sy;
    if (!f)
    {
        cout << "Некоректно введена первая переменная\n";
        cin.clear();
        cin.ignore(256, '\n');
        cin >> f >> s >> sy;
    }
    if (!s)
    {
        cout << "Некоректно введена вторая переменная\n";
        cin.clear();
        cin.ignore(256, '\n');
        cin >> f >> s >> sy;
    }
    if (((sy) == !(sy)) || ((sy != '+') && (sy != '-') && (sy != '*') && (sy != '/')))
    {
        cout << "Некоректно введено действие \n";
        cin.clear();
        cin.ignore(256, '\n');
        cin >> f >> s >> sy;
    }

    switch (sy)
    {
    case '+':
    {
        cout << "Ответ:" << f + s << "\n";
        break;
    }
    case '-':
    {
        cout << "Ответ:" << f - s << "\n";
        break;
    }
    case '*':
    {
        cout << "Ответ:" << f * s << "\n";
        break;
    }
    case '/':
    {
        if (s == 0)
        {
            cout << "Ошибка, делить на ноль нельзя" << "\n";
            exit(1);
        }
        else
        {
            cout << "Ответ:" << f / s << "\n";
            break;
        }
    }
    }
    system("pause");
}

void check_an_empty_string()
{
    while (int a = 1 != 0)
    {
        cout << "Введите любой символ кроме ввода чтобы прейти к калькулятору ввод выйдет из программы\n";
        cin.ignore(256, '\n');
        while ((cin.get() != '\n'))
        {
            calc();
        }
        cout<< "Введите любой символ кроме ввода чтобы прейти к калькулятору ввод выйдет из программы\n";
        while ((cin.get() == '\n'))
        {
            cout<< "Пустая строка\n";
            exit(1);
        }
    }
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void str_in_uppercase()                                                        //Задание 2
{
    string strb;
    cout << "Введите строку\n";
    cin >> strb;
    for (int i = 0; i < strb.size(); i++)
    {
        strb[i] = toupper(strb[i]);
    }
    cout << strb << "\n";
}

void str_in_lowercase()
{
    string strb;
    cout << "Введите строку\n";
    cin >> strb;
    for (int i = 0; i < strb.size(); i++)
    {
        strb[i] = tolower(strb[i]);
    }
    cout << strb << "\n";
}

void conkatination()
{
    string strinput, srtconc;
    char str = '0';
    int a = 0;
    while (a != 2)
    {
        cout << "Введите строку или 0 чтобы получить ответ\n";
        cin >> strinput;
        if (strinput[a] == str)
        {
            a = 2;
            strinput = '\n';
        }
        srtconc = srtconc + strinput;
    }
    cout << "Ответ:" << srtconc << "\n";
}

void output_in_file()
{
    string str;
    ofstream fileout;
    int a = 0;

    fileout.open("fileout.txt");
    while (a != 2)
    {
        cout << "Введите строку или 0 чтобы закончить\n";
        cin >> str;
        if (str[a] == '0')
        {
            a = 2;
            str = '\n';
        }
        fileout << str <<"\n";
    }
    cout << "Название файла fileout.txt\n";
    fileout.close();
}

void read_from_file() 
{
    char str[256];
    ifstream fileread;
    if(fileread.is_open())
    {
        cout << "Открывается файл созданный в 4 пункте\n";
        fileread.open("fileout.txt");
        fileread.getline(str, 256, '\n');
        cout << str << "\n";
    }
    else
    {
        cout << "Не создан файл в 4 задании просьба создать его\n";
        exit(1);
    }
    fileread.close();
}

void choose_in_second_exercise()
{
    int choose1, choose2, a = 0;
    while (a != 1)
    {
        cout << "Что хотите сделать?\n1)Выйти в меню заданий\n2)Преобразовать регистр\n3)Конкатенация строк\n4)Вывод строк в файл\n5)Чтение из произвольного файла\n";
        cin >> choose1;
        switch (choose1)
        {
        case 1:
        {
            a = 1;
            break;
        }
        case 2:
        {
            while (a != 3)
            {
                cout << "В какой регистр хотите преобразовать?\n1)В верхний\n2)В нижний\n3)Выход\n";
                cin >> choose2;
                switch (choose2)
                {
                case 1:
                {
                    str_in_uppercase();
                    break;
                }
                case 2:
                {
                    str_in_lowercase();
                    break;
                }
                case 3:
                {
                    a = 3;
                    break;
                }
                default:
                {
                    cout << "Ошибка, повторите ввод\n";
                    break;
                }
                }
            }
            break;
        }
        case 3:
        {
            conkatination();
            break;
        }
        case 4:
        {
            output_in_file();
            break;
        }
        case 5:
        {
            read_from_file();
            break;
        }
        default:
        {
            cout << "Ошибка, повторите ввод\n";
            break;
        }
        }
    }
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
unordered_map < string, int > common_word()                                            //Задание 3
{
    unordered_map < string, int > search;
    char* wor;
    string str;

    getline(cin, str);
    cout << "\n";
    for (int i = 0; i < str.size(); i++)
    {
        str[i] = tolower(str[i]);
    }
    char* countstr = &str[0];
    char* ysl = strtok(countstr, " ");
    while (ysl != NULL)
    {
        search[string(ysl)]++;
        ysl = strtok(NULL, " ");
    }
    return search;
}
void search_common_word()
{
    cout << "Введите текст :\n";

    unordered_map < string, int > search = common_word();
    int cword = 0;
    string word = "\0";
    for (const auto& lost : search)
    {
        if (lost.second > cword)
        {
            cword = lost.second;
            word = lost.first;
        }
    }
    cout << "Наиболее встречаемое слово: " << word << "\n";
    cout << "Количество встреченных слов: " << cword + 1 << "\n";
    system("pause");
}

void choose_exercise()
{
    int z;
    cout << "Выберите номер задания\n1)Калькулятор\n2)Работа со строками\n3)Поиск слова\n";
    cin >> z;
    while (z)
    {
        switch (z)
        {
        case 1:
        {
            check_an_empty_string();
            cout << "Выберите номер задания\n1)Калькулятор\n2)Работа со строками\n3)Поиск слова\n";
            cin >> z;
            break;
        }
        case 2:
        {
            choose_in_second_exercise();
            cout << "Выберите номер задания\n1)Калькулятор\n2)Работа со строками\n3)Поиск слова\n";
            cin >> z;
            break;
        }
        case 3:
        {
            common_word();
            search_common_word();
            cout << "Выберите номер задания\n1)Калькулятор\n2)Работа со строками\n3)Поиск слова\n";
            cin >> z;
            break;
        }
        default:
            cout << "Ошибка выбора\n";
            exit(1);
        }
    }
}

int main()
{
    SetConsoleCP(1251);
    SetConsoleOutputCP(1251);
    setlocale(LC_ALL, "Rus");

    choose_exercise();
	return 0;
}
